{"version":3,"file":"js/211.12c9ed0b.js","mappings":"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","sources":["webpack://rouge_vue/./src/axios.js","webpack://rouge_vue/./src/store/user.js","webpack://rouge_vue/./src/views/system/SystemUsers.vue","webpack://rouge_vue/./src/views/system/SystemUsers.vue?54b3"],"sourcesContent":["import axios from 'axios'\r\nimport { useAuthStore } from './store/auth'\r\n\r\nconst http = axios.create({\r\n  baseURL: '/api'\r\n})\r\n\r\n// 请求拦截器：添加token\r\nhttp.interceptors.request.use(config => {\r\n  const authStore = useAuthStore()\r\n  if (authStore.token) {\r\n    config.headers.Authorization = `Bearer ${authStore.token}`\r\n  }\r\n  return config\r\n}, error => {\r\n  return Promise.reject(error)\r\n})\r\n\r\n// 响应拦截器：处理token失效和数据格式\r\nhttp.interceptors.response.use(response => {\r\n  // 如果响应数据有body字段，则直接返回body内容\r\n  if (response.data && response.data.body) {\r\n    return {\r\n      ...response,\r\n      data: response.data.body\r\n    }\r\n  }\r\n  return response\r\n}, error => {\r\n  if (error.response.status === 401) {\r\n    const authStore = useAuthStore()\r\n    authStore.clearAuth()\r\n    // 跳转到登录页\r\n    window.location.href = '/login'\r\n  }\r\n  return Promise.reject(error)\r\n})\r\n\r\nexport default http","import { defineStore } from \"pinia\"\r\nimport http from \"@/axios\"\r\n\r\nexport const useUserStore = defineStore(\"user\", {\r\n  state: () => {\r\n    return {\r\n      loading: true,\r\n      user: {\r\n        id: null,\r\n        name: '',\r\n        email: '',\r\n        saltedPassword: '',\r\n        role: '',\r\n        createdAt: null,\r\n        updatedAt: null\r\n      }\r\n    }\r\n  },\r\n  actions: {\r\n    async fetchUser() {\r\n      this.loading = true\r\n      try {\r\n        const response = await http.get(\"/user/info\")\r\n        this.user = response.data\r\n      } finally {\r\n        this.loading = false\r\n      }\r\n    },\r\n\r\n    async updateUser(user) {\r\n      await http.put(\"/user/update\", user)\r\n      await this.fetchUser()\r\n    },\r\n\r\n    async deleteUser() {\r\n      await http.delete(\"/user/delete\")\r\n    }\r\n  }\r\n})","<template>\r\n  <div class=\"container\">\r\n    <div class=\"loading\" v-loading=\"userStore.loading\"></div>\r\n    <div v-if=\"!userStore.loading\" class=\"user-card\">\r\n      <div class=\"user-info\">\r\n        <h2>用户信息</h2>\r\n        <div class=\"info-item\">\r\n          <span class=\"label\">用户名：</span>\r\n          <span class=\"value\">{{ user.name }}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"label\">邮箱：</span>\r\n          <span class=\"value\">{{ user.email }}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"label\">身份：</span>\r\n          <span class=\"value\">{{ user.role }}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"label\">注册时间：</span>\r\n          <span class=\"value\">{{ user.createdAt }}</span>\r\n        </div>\r\n        <div class=\"info-item\">\r\n          <span class=\"label\">更新时间：</span>\r\n          <span class=\"value\">{{ user.updatedAt }}</span>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"actions\">\r\n        <el-button type=\"primary\" @click=\"handleEdit\">修改账户</el-button>\r\n        <el-button type=\"warning\" @click=\"handleLogout\">退出登录</el-button>\r\n        <el-button type=\"danger\" @click=\"confirmDelete\">注销账户</el-button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 修改账户弹窗 -->\r\n    <el-dialog v-model=\"showEditDialog\" title=\"修改账户信息\" width=\"30%\">\r\n      <el-form :model=\"editForm\" :rules=\"rules\" label-width=\"80px\" ref=\"formRef\">\r\n        <el-form-item label=\"用户名\">\r\n          <el-input v-model=\"editForm.name\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"密码\" prop=\"password\">\r\n          <el-input v-model=\"editForm.password\" type=\"password\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <el-button @click=\"showEditDialog = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"handleUpdate\">确认</el-button>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport router from '@/router'\r\nimport { useUserStore } from '@/store/user'\r\nimport { useAuthStore } from '@/store/auth'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport { onBeforeMount, ref } from 'vue'\r\nimport { storeToRefs } from 'pinia'\r\n\r\nconst userStore = useUserStore()\r\nconst { user } = storeToRefs(userStore)\r\nconst showEditDialog = ref(false)\r\nconst editForm = ref({\r\n  name: '',\r\n  password: ''\r\n})\r\n\r\nconst rules = {\r\n  password: [\r\n    { required: true, message: '请输入密码', trigger: 'blur' },\r\n    { min: 6, message: '密码长度不能小于6位', trigger: 'blur' }\r\n  ]\r\n}\r\n\r\nonBeforeMount(async () => {\r\n  try {\r\n    await userStore.fetchUser()\r\n  } catch (error) {\r\n    handleError(error)\r\n  }\r\n})\r\nconst handleEdit = () => {\r\n  editForm.value.password = ''\r\n  editForm.value.name = user.value.name\r\n  showEditDialog.value = true\r\n}\r\n\r\nconst formRef = ref(null)\r\n\r\nconst handleUpdate = async () => {\r\n  try {\r\n    await formRef.value.validate()\r\n    await userStore.updateUser(editForm.value)\r\n    ElMessage.success('账户信息更新成功')\r\n    showEditDialog.value = false\r\n  } catch (error) {\r\n    handleError(error)\r\n  }\r\n}\r\n\r\nconst confirmDelete = () => {\r\n  ElMessageBox.confirm('确定要注销账户吗？此操作不可恢复', '警告', {\r\n    confirmButtonText: '确定',\r\n    cancelButtonText: '取消',\r\n    type: 'warning'\r\n  }).then(async () => {\r\n    try {\r\n      await userStore.deleteUser()\r\n      ElMessage.success('账户已注销')\r\n      window.location.href = '/login'\r\n    } catch (error) {\r\n      handleError(error)\r\n    }\r\n  }).catch(() => {\r\n\r\n  })\r\n}\r\n\r\nconst handleError = (error) => {\r\n  ElMessage.error(error.response?.data || error.message)\r\n  setTimeout(() => router.push('/login'), 500)\r\n}\r\n\r\nconst authStore = useAuthStore()\r\nconst handleLogout = () => {\r\n  ElMessageBox.confirm('确定要退出登录吗？', '警告', {\r\n    confirmButtonText: '确定',\r\n    cancelButtonText: '取消',\r\n    type: 'warning'\r\n  }).then(async () => {\r\n    authStore.clearAuth()\r\n    router.push('/login')\r\n  }).catch(() => {\r\n\r\n  })\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  padding-top: 10%;\r\n}\r\n\r\n.user-card {\r\n  background-color: #2D333B;\r\n  border-radius: 8px;\r\n  padding: 20px;\r\n  color: #E5E5E5;\r\n  max-width: 600px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.user-info h2 {\r\n  color: #FFFFFF;\r\n  margin-bottom: 20px;\r\n  border-bottom: 1px solid #444C54;\r\n  padding-bottom: 10px;\r\n}\r\n\r\n.info-item {\r\n  margin-bottom: 15px;\r\n  display: flex;\r\n}\r\n\r\n.label {\r\n  font-weight: bold;\r\n  width: 100px;\r\n  color: #ADBAC7;\r\n}\r\n\r\n.value {\r\n  flex: 1;\r\n}\r\n\r\n.actions {\r\n  margin-top: 30px;\r\n  display: flex;\r\n  justify-content: center;\r\n  gap: 20px;\r\n}\r\n\r\n.actions .el-button {\r\n  border-color: #444C54;\r\n  color: #E5E5E5;\r\n}\r\n\r\n.actions .el-button--primary {\r\n  background-color: #3D444D;\r\n}\r\n\r\n.actions .el-button--warning {\r\n  background-color: #5C4D3D;\r\n}\r\n\r\n.actions .el-button--danger {\r\n  background-color: #5C3D3D;\r\n}\r\n\r\n.actions .el-button:hover {\r\n  opacity: 0.9;\r\n}\r\n\r\n:deep(.el-dialog) {\r\n  background-color: #252B33;\r\n  color: #E5E5E5;\r\n}\r\n\r\n:deep(.el-dialog__title) {\r\n  color: #FFFFFF;\r\n}\r\n\r\n:deep(.el-form-item__label) {\r\n  color: #ADBAC7 !important;\r\n}\r\n\r\n.loading {\r\n  position: absolute;\r\n  top: 50%;\r\n  width: 80%;\r\n}\r\n</style>","import script from \"./SystemUsers.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./SystemUsers.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./SystemUsers.vue?vue&type=style&index=0&id=ca88d7c8&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-ca88d7c8\"]])\n\nexport default __exports__"],"names":["http","axios","create","baseURL","interceptors","request","use","config","authStore","useAuthStore","token","headers","Authorization","error","Promise","reject","response","data","body","status","clearAuth","window","location","href","useUserStore","defineStore","state","loading","user","id","name","email","saltedPassword","role","createdAt","updatedAt","actions","fetchUser","this","get","updateUser","put","deleteUser","delete","userStore","storeToRefs","showEditDialog","ref","editForm","password","rules","required","message","trigger","min","onBeforeMount","async","handleError","handleEdit","value","formRef","handleUpdate","validate","ElMessage","success","confirmDelete","ElMessageBox","confirm","confirmButtonText","cancelButtonText","type","then","catch","setTimeout","router","push","handleLogout","__exports__"],"sourceRoot":""}