"use strict";(self["webpackChunkrouge_vue"]=self["webpackChunkrouge_vue"]||[]).push([[487],{3173:function(e,a,s){var l=s(4373),t=s(9519);const n=l.A.create({baseURL:"/api"});n.interceptors.request.use((e=>{const a=(0,t.n)();return a.token&&(e.headers.Authorization=`Bearer ${a.token}`),e}),(e=>Promise.reject(e))),n.interceptors.response.use((e=>e.data&&e.data.body?{...e,data:e.data.body}:e),(e=>{if(401===e.response.status){const e=(0,t.n)();e.clearAuth(),window.location.href="/login"}return Promise.reject(e)})),a.A=n},5487:function(e,a,s){s.r(a),s.d(a,{default:function(){return B}});s(4114);var l=s(6768),t=s(144),n=s(4232),r=s(7123),o=s(2261),u=s(3173);const i=(0,o.nY)("user",{state:()=>({loading:!0,user:{id:null,name:"",email:"",saltedPassword:"",role:"",createdAt:null,updatedAt:null}}),actions:{async fetchUser(){this.loading=!0;try{const e=await u.A.get("/user/info");this.user=e.data}finally{this.loading=!1}},async updateUser(e){await u.A.put("/user/update",e),await this.fetchUser()},async deleteUser(){await u.A.delete("/user/delete")}}});var c=s(9519),d=s(1219),p=s(2933);const k={class:"container"},v={class:"loading"},m={key:0,class:"user-card"},f={class:"user-info"},g={class:"info-item"},b={class:"value"},h={class:"info-item"},w={class:"value"},y={class:"info-item"},_={class:"value"},L={class:"info-item"},A={class:"value"},R={class:"info-item"},U={class:"value"},F={class:"actions"};var C={__name:"Users",setup(e){const a=i(),{user:s}=(0,o.bP)(a),u=(0,t.KR)(!1),C=(0,t.KR)({name:"",password:""}),V={password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}]};(0,l.KC)((async()=>{try{await a.fetchUser()}catch(e){K(e)}}));const x=()=>{C.value.password="",C.value.name=s.value.name,u.value=!0},B=(0,t.KR)(null),T=async()=>{try{await B.value.validate(),await a.updateUser(C.value),d.nk.success("账户信息更新成功"),u.value=!1}catch(e){K(e)}},W=()=>{p.s.confirm("确定要注销账户吗？此操作不可恢复","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await a.deleteUser(),d.nk.success("账户已注销"),window.location.href="/login"}catch(e){K(e)}})).catch((()=>{}))},K=e=>{d.nk.error(e.response?.data||e.message),setTimeout((()=>r.A.push("/login")),500)},P=(0,c.n)(),j=()=>{p.s.confirm("确定要退出登录吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{P.clearAuth(),r.A.push("/login")})).catch((()=>{}))};return(e,r)=>{const o=(0,l.g2)("el-button"),i=(0,l.g2)("el-input"),c=(0,l.g2)("el-form-item"),d=(0,l.g2)("el-form"),p=(0,l.g2)("el-dialog"),K=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",k,[(0,l.bo)((0,l.Lk)("div",v,null,512),[[K,(0,t.R1)(a).loading]]),(0,t.R1)(a).loading?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",m,[(0,l.Lk)("div",f,[r[9]||(r[9]=(0,l.Lk)("h2",null,"用户信息",-1)),(0,l.Lk)("div",g,[r[4]||(r[4]=(0,l.Lk)("span",{class:"label"},"用户名：",-1)),(0,l.Lk)("span",b,(0,n.v_)((0,t.R1)(s).name),1)]),(0,l.Lk)("div",h,[r[5]||(r[5]=(0,l.Lk)("span",{class:"label"},"邮箱：",-1)),(0,l.Lk)("span",w,(0,n.v_)((0,t.R1)(s).email),1)]),(0,l.Lk)("div",y,[r[6]||(r[6]=(0,l.Lk)("span",{class:"label"},"身份：",-1)),(0,l.Lk)("span",_,(0,n.v_)((0,t.R1)(s).role),1)]),(0,l.Lk)("div",L,[r[7]||(r[7]=(0,l.Lk)("span",{class:"label"},"注册时间：",-1)),(0,l.Lk)("span",A,(0,n.v_)((0,t.R1)(s).createdAt),1)]),(0,l.Lk)("div",R,[r[8]||(r[8]=(0,l.Lk)("span",{class:"label"},"更新时间：",-1)),(0,l.Lk)("span",U,(0,n.v_)((0,t.R1)(s).updatedAt),1)])]),(0,l.Lk)("div",F,[(0,l.bF)(o,{type:"primary",onClick:x},{default:(0,l.k6)((()=>r[10]||(r[10]=[(0,l.eW)("修改账户")]))),_:1}),(0,l.bF)(o,{type:"warning",onClick:j},{default:(0,l.k6)((()=>r[11]||(r[11]=[(0,l.eW)("退出登录")]))),_:1}),(0,l.bF)(o,{type:"danger",onClick:W},{default:(0,l.k6)((()=>r[12]||(r[12]=[(0,l.eW)("注销账户")]))),_:1})])])),(0,l.bF)(p,{modelValue:u.value,"onUpdate:modelValue":r[3]||(r[3]=e=>u.value=e),title:"修改账户信息",width:"30%"},{footer:(0,l.k6)((()=>[(0,l.bF)(o,{onClick:r[2]||(r[2]=e=>u.value=!1)},{default:(0,l.k6)((()=>r[13]||(r[13]=[(0,l.eW)("取消")]))),_:1}),(0,l.bF)(o,{type:"primary",onClick:T},{default:(0,l.k6)((()=>r[14]||(r[14]=[(0,l.eW)("确认")]))),_:1})])),default:(0,l.k6)((()=>[(0,l.bF)(d,{model:C.value,rules:V,"label-width":"80px",ref_key:"formRef",ref:B},{default:(0,l.k6)((()=>[(0,l.bF)(c,{label:"用户名"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:C.value.name,"onUpdate:modelValue":r[0]||(r[0]=e=>C.value.name=e)},null,8,["modelValue"])])),_:1}),(0,l.bF)(c,{label:"密码",prop:"password"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:C.value.password,"onUpdate:modelValue":r[1]||(r[1]=e=>C.value.password=e),type:"password"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])}}},V=s(1241);const x=(0,V.A)(C,[["__scopeId","data-v-7251bc8b"]]);var B=x}}]);
//# sourceMappingURL=487.af7e67be.js.map