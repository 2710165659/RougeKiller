"use strict";(self["webpackChunkrouge_vue"]=self["webpackChunkrouge_vue"]||[]).push([[457],{2457:function(a,e,s){s.r(e),s.d(e,{default:function(){return S}});var l=s(6768),t=s(144),r=s(5130),o=s(4232),n=s(7477),u=s(2261),i=s(3173);const c=(0,u.nY)("reviewTask",{state:()=>({data:[],loading:!1,hasMore:!0,params:{url:"",status:"",page:1,size:10}}),actions:{async searchTasks(a=!1){if(!a||!this.loading&&this.hasMore){a||(this.params.page=1),this.loading=!0;try{const e=await i.A.get("/tasks",{params:this.params});this.data=a?[...this.data,...e.data]:e.data,this.hasMore=e.data.length>=this.params.size,this.hasMore&&this.params.page++}finally{this.loading=!1}}},async startTask(a){await i.A.post("/tasks/start",{id:a}),await this.searchTasks()},async deleteTask(a){await i.A.delete("tasks/"+a),await this.searchTasks()},async addTask(a){await i.A.post("/tasks",{fullUrl:a}),await this.resetSearch()},async resetSearch(){this.params.url="",this.params.status="",this.params.page=1,this.params.size=10,await this.searchTasks()}}});var d=s(2933),k=s(1219);const p={key:0,class:"task-info-container"},v={class:"info-row"},f={class:"value"},b={class:"info-row"},h={class:"value"},m={class:"info-row"},_={class:"info-row"},g={class:"value"},w={class:"info-row"},y={class:"value"},F={class:"info-row"},L={class:"value"},R={key:0,class:"info-row"},C={class:"value error"};var T={__name:"TaskInfo",setup(a,{expose:e}){const s=(0,t.KR)(!1),r=(0,t.KR)(null),n=a=>{a()},u=a=>{if(!a)return"";const e=new Date(a);return e.toLocaleString("zh-CN")};return e({show:a=>{r.value=a,s.value=!0}}),(a,e)=>{const t=(0,l.g2)("el-tag"),i=(0,l.g2)("el-button"),c=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(c,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value=a),title:"检测任务详情",width:"600px","before-close":n},{footer:(0,l.k6)((()=>[(0,l.bF)(i,{onClick:e[0]||(e[0]=a=>s.value=!1)},{default:(0,l.k6)((()=>e[9]||(e[9]=[(0,l.eW)("关闭")]))),_:1})])),default:(0,l.k6)((()=>[r.value?((0,l.uX)(),(0,l.CE)("div",p,[(0,l.Lk)("div",v,[e[2]||(e[2]=(0,l.Lk)("span",{class:"label"},"ID:",-1)),(0,l.Lk)("span",f,(0,o.v_)(r.value.id),1)]),(0,l.Lk)("div",b,[e[3]||(e[3]=(0,l.Lk)("span",{class:"label"},"URL:",-1)),(0,l.Lk)("span",h,(0,o.v_)(r.value.fullUrl),1)]),(0,l.Lk)("div",m,[e[4]||(e[4]=(0,l.Lk)("span",{class:"label"},"状态:",-1)),(0,l.bF)(t,{type:"完成"===r.value.status?"success":"失败"===r.value.status?"danger":"primary"},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(r.value.status),1)])),_:1},8,["type"])]),(0,l.Lk)("div",_,[e[5]||(e[5]=(0,l.Lk)("span",{class:"label"},"添加人:",-1)),(0,l.Lk)("span",g,(0,o.v_)(r.value.name),1)]),(0,l.Lk)("div",w,[e[6]||(e[6]=(0,l.Lk)("span",{class:"label"},"创建时间:",-1)),(0,l.Lk)("span",y,(0,o.v_)(u(r.value.createdAt)),1)]),(0,l.Lk)("div",F,[e[7]||(e[7]=(0,l.Lk)("span",{class:"label"},"更新时间:",-1)),(0,l.Lk)("span",L,(0,o.v_)(u(r.value.updatedAt)),1)]),r.value.errorMessage?((0,l.uX)(),(0,l.CE)("div",R,[e[8]||(e[8]=(0,l.Lk)("span",{class:"label"},"错误信息:",-1)),(0,l.Lk)("span",C,(0,o.v_)(r.value.errorMessage),1)])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])),_:1},8,["modelValue"])}}},V=s(1241);const A=(0,V.A)(T,[["__scopeId","data-v-e724b3a2"]]);var U=A,W={__name:"AddTask",setup(a,{expose:e}){const s=c(),r=(0,t.KR)(!1),o=(0,t.KR)({url:""}),n=a=>{a()},u=()=>{s.addTask(o.value.url),r.value=!1,k.nk.success("新增检测任务成功")};return e({show:()=>{o.value.url="",r.value=!0}}),(a,e)=>{const s=(0,l.g2)("el-input"),t=(0,l.g2)("el-form-item"),i=(0,l.g2)("el-form"),c=(0,l.g2)("el-button"),d=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.Wv)(d,{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value=a),title:"新增检测任务",width:"600px","before-close":n},{footer:(0,l.k6)((()=>[(0,l.bF)(c,{onClick:e[1]||(e[1]=a=>r.value=!1),type:"info"},{default:(0,l.k6)((()=>e[3]||(e[3]=[(0,l.eW)("取消")]))),_:1}),(0,l.bF)(c,{type:"primary",onClick:u},{default:(0,l.k6)((()=>e[4]||(e[4]=[(0,l.eW)("添加")]))),_:1})])),default:(0,l.k6)((()=>[(0,l.bF)(i,{model:o.value,"label-width":"80px"},{default:(0,l.k6)((()=>[(0,l.bF)(t,{label:"URL",required:""},{default:(0,l.k6)((()=>[(0,l.bF)(s,{modelValue:o.value.url,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.url=a),placeholder:"请输入待检测的URL",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])}}};const x=(0,V.A)(W,[["__scopeId","data-v-8fc88de6"]]);var X=x;const I={class:"task-container"},M={class:"search-container"},D={class:"table-container"},E={key:0,class:"loading-more"},K={key:2,class:"no-more"};var z={__name:"ReviewTask",setup(a){const e=c(),s=(0,t.KR)(),u=(0,t.KR)();(0,l.sV)((()=>{v()}));const i=()=>{u.value.show()},p=async a=>{try{await d.s.confirm("确定要删除此任务吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",effect:"dark"}),e.deleteTask(a),k.nk.error("删除成功")}catch(s){}},v=async(a=!1)=>{try{await e.searchTasks(a)}catch(s){k.nk.error(s.response?.data||s.message)}},f=async()=>{try{await e.resetSearch()}catch(a){k.nk.error(a.response?.data||a.message)}};return(a,c)=>{const d=(0,l.g2)("el-input"),k=(0,l.g2)("el-form-item"),b=(0,l.g2)("el-col"),h=(0,l.g2)("el-option"),m=(0,l.g2)("el-select"),_=(0,l.g2)("el-button"),g=(0,l.g2)("el-row"),w=(0,l.g2)("el-form"),y=(0,l.g2)("el-table-column"),F=(0,l.g2)("el-table");return(0,l.uX)(),(0,l.CE)("div",I,[c[9]||(c[9]=(0,l.Lk)("div",{class:"task-title"},"检测任务配置",-1)),(0,l.Lk)("div",M,[(0,l.bF)(w,{"label-width":"80px"},{default:(0,l.k6)((()=>[(0,l.bF)(g,null,{default:(0,l.k6)((()=>[(0,l.bF)(b,{span:6,offset:1},{default:(0,l.k6)((()=>[(0,l.bF)(k,{label:"URL"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{modelValue:(0,t.R1)(e).params.url,"onUpdate:modelValue":c[0]||(c[0]=a=>(0,t.R1)(e).params.url=a),placeholder:"请输入URL",class:"search-input","prefix-icon":(0,t.R1)(n.vji)},null,8,["modelValue","prefix-icon"])])),_:1})])),_:1}),(0,l.bF)(b,{span:6,offset:1},{default:(0,l.k6)((()=>[(0,l.bF)(k,{label:"任务状态"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{modelValue:(0,t.R1)(e).params.status,"onUpdate:modelValue":c[1]||(c[1]=a=>(0,t.R1)(e).params.status=a),placeholder:"请选择任务状态",effect:"dark"},{default:(0,l.k6)((()=>[(0,l.bF)(h,{label:"待定",value:"待定"}),(0,l.bF)(h,{label:"进行中",value:"进行中"}),(0,l.bF)(h,{label:"失败",value:"失败"}),(0,l.bF)(h,{label:"完成",value:"完成"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(b,{span:6,offset:2},{default:(0,l.k6)((()=>[(0,l.bF)(_,{type:"primary",onClick:v,icon:(0,t.R1)(n.vji)},{default:(0,l.k6)((()=>c[3]||(c[3]=[(0,l.eW)(" 搜索 ")]))),_:1},8,["icon"]),(0,l.bF)(_,{onClick:f,icon:(0,t.R1)(n.C42),type:"info"},{default:(0,l.k6)((()=>c[4]||(c[4]=[(0,l.eW)("清空")]))),_:1},8,["icon"]),(0,l.bF)(_,{type:"primary",onClick:i},{default:(0,l.k6)((()=>c[5]||(c[5]=[(0,l.eW)(" 新增检测任务 ")]))),_:1})])),_:1})])),_:1})])),_:1})]),(0,l.Lk)("div",D,[(0,l.bF)(F,{class:"table",data:(0,t.R1)(e).data,stripe:"","table-layout":"auto"},{append:(0,l.k6)((()=>[(0,t.R1)(e).loading?((0,l.uX)(),(0,l.CE)("div",E," 加载中... ")):(0,t.R1)(e).hasMore?((0,l.uX)(),(0,l.CE)("div",{key:1,class:"load-more",onClick:c[2]||(c[2]=a=>v(!0))}," 点击加载更多 ")):((0,l.uX)(),(0,l.CE)("div",K,"没有更多数据了"))])),default:(0,l.k6)((()=>[(0,l.bF)(y,{prop:"id",label:"ID",sortable:""}),(0,l.bF)(y,{prop:"fullUrl",label:"检测URL"}),(0,l.bF)(y,{prop:"name",label:"添加人",align:"center",sortable:""}),(0,l.bF)(y,{prop:"status",label:"任务状态",align:"center",sortable:""}),(0,l.bF)(y,{label:"任务操作",align:"center"},{default:(0,l.k6)((a=>[(0,l.bF)(_,{type:"success",onClick:(0,r.D$)((s=>(0,t.R1)(e).startTask(a.row.id)),["prevent"]),disabled:"完成"===a.row.status||"进行中"===a.row.status},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)("失败"===a.row.status?"重试":"开始"),1)])),_:2},1032,["onClick","disabled"]),(0,l.bF)(_,{type:"danger",onClick:(0,r.D$)((e=>p(a.row.id)),["prevent"])},{default:(0,l.k6)((()=>c[6]||(c[6]=[(0,l.eW)(" 删除 ")]))),_:2},1032,["onClick"]),(0,l.bF)(_,{type:"info",onClick:(0,r.D$)((e=>s.value.show(a.row)),["prevent"])},{default:(0,l.k6)((()=>c[7]||(c[7]=[(0,l.eW)(" 查看 ")]))),_:2},1032,["onClick"])])),_:1}),c[8]||(c[8]=(0,l.eW)(" > "))])),_:1},8,["data"])]),(0,l.bF)(U,{ref_key:"taskInfoRef",ref:s},null,512),(0,l.bF)(X,{ref_key:"addTaskRef",ref:u},null,512)])}}};const j=(0,V.A)(z,[["__scopeId","data-v-333ba970"]]);var S=j},3173:function(a,e,s){s(4114);var l=s(4373),t=s(9519),r=s(1156);const o=l.A.create({baseURL:"/api"});o.interceptors.request.use((a=>{const e=(0,t.n)();return e.token&&(a.headers.Authorization=`Bearer ${e.token}`),a}),(a=>Promise.reject(a))),o.interceptors.response.use((a=>a.data&&a.data.body?{...a,data:a.data.body}:a),(a=>{if(401===a.response.status){const a=(0,t.n)();a.clearAuth(),r.A.push("/login")}return Promise.reject(a)})),e.A=o}}]);
//# sourceMappingURL=457.d6eaf48a.js.map